<!DOCTYPE html>
<html lang="el">
<head>
<meta charset="UTF-8">
<title>Bingo Hall TV</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<h1>BINGO HALL</h1>

<div id="number">--</div>

<label for="speed">Ταχύτητα κλήρωσης:</label>
<select id="speed">
  <option value="5000">5 δευτ</option>
  <option value="3000">3 δευτ</option>
  <option value="1500">1.5 δευτ</option>
</select>

<button onclick="startDraw()">START</button>

<h3>Δημιουργία Κουπονιών</h3>
<input type="text" id="playerName" placeholder="Όνομα Παίκτη">
<button onclick="createTicket()">ΔΗΜΙΟΥΡΓΙΑ ΚΟΥΠΟΝΙΟΥ</button>

<div id="tickets"></div>

<div id="winner">
  <h2 id="wname"></h2>
  <p id="wwins"></p>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();

function startDraw() {
    const speed = +document.getElementById("speed").value;
    socket.emit("startDraw", speed);
}

socket.on("number", n => {
    const numberDiv = document.getElementById("number");
    numberDiv.textContent = n;
    numberDiv.classList.remove("animate");
    void numberDiv.offsetWidth;
    numberDiv.classList.add("animate");

    // Επισημαίνει αριθμούς στα κουπόνια
    document.querySelectorAll(".ticket").forEach(ticket => {
        ticket.querySelectorAll(".cell").forEach(cell => {
            if (+cell.textContent === n) cell.classList.add("mark");
        });
    });
});

socket.on("winner", w => {
    document.getElementById("wname").textContent = w.name;
    document.getElementById("wwins").textContent = "Νίκες: " + (w.wins || 1);
    document.getElementById("winner").style.display = "flex";
});

function createTicket() {
    const player = document.getElementById("playerName").value || "Άγνωστος";
    const nums = Array.from({ length: 90 }, (_, i) => i + 1)
        .sort(() => Math.random() - 0.5)
        .slice(0, 25);
    const id = Math.random().toString(36).slice(2);

    // Στέλνουμε στον server
    socket.emit("createTicket", { id, nums, player });

    // Δημιουργούμε το κουπόνι στην οθόνη
    const ticketsDiv = document.getElementById("tickets");
    const ticketDiv = document.createElement("div");
    ticketDiv.className = "ticket";
    ticketDiv.innerHTML = "<h4>" + player + "</h4>";

    const grid = document.createElement("div");
    grid.className = "grid";
    nums.forEach(n => {
        const cell = document.createElement("div");
        cell.className = "cell";
        cell.textContent = n;
        grid.appendChild(cell);
    });
    ticketDiv.appendChild(grid);
    ticketsDiv.appendChild(ticketDiv);
}
</script>
</body>
</html>
